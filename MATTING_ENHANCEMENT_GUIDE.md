# 抠图细节增强指南

## 概述

本指南介绍了HivisionIDPhotos中新增的抠图细节增强功能，特别针对细微发丝处理的改进。基于ComfyUI中RMBG 2.0的最佳实践参数，我们添加了敏感度和处理分辨率调节功能。

## 新增功能

### 1. 抠图敏感度 (Matting Sensitivity)

**功能说明：**
- 控制抠图算法对细微细节的敏感程度
- 范围：0.1 - 1.0
- 默认值：0.95
- 步长：0.05

**参数效果：**
- **高敏感度 (0.9-1.0)**: 保留更多细微发丝和边缘细节，适合需要精细抠图的场景
- **中等敏感度 (0.7-0.9)**: 平衡细节保留和边缘平滑，适合大多数证件照
- **低敏感度 (0.1-0.7)**: 更加平滑的边缘，减少噪点，适合背景复杂的图片

### 2. 处理分辨率 (Processing Resolution)

**功能说明：**
- 控制抠图模型的输入分辨率
- 选项：512, 1024, 2048
- 默认值：1024

**分辨率效果：**
- **512**: 处理速度快，适合快速预览
- **1024**: 平衡质量和速度，推荐设置
- **2048**: 最高质量，处理时间较长，适合高质量输出

## 技术实现

### 敏感度算法

使用幂函数调整mask的对比度：
```python
gamma = 2.0 - sensitivity
result = np.power(result, gamma)
```

- 当sensitivity=0.95时，gamma=1.05，轻微增强细节
- 当sensitivity=0.1时，gamma=1.9，显著平滑边缘

### 插值优化

使用LANCZOS插值替代BILINEAR插值，提供更好的边缘质量：
```python
pil_im = pil_im.resize(orig_image.size, Image.LANCZOS)
```

## 使用建议

### 针对不同场景的推荐设置

1. **精细发丝处理**
   - 敏感度：0.95
   - 处理分辨率：2048
   - 适用：需要保留完整发丝细节的高质量证件照

2. **标准证件照**
   - 敏感度：0.85
   - 处理分辨率：1024
   - 适用：日常证件照处理

3. **快速处理**
   - 敏感度：0.75
   - 处理分辨率：512
   - 适用：批量处理或预览

4. **复杂背景**
   - 敏感度：0.65
   - 处理分辨率：1024
   - 适用：背景复杂、需要减少噪点的图片

## 性能考虑

- **处理时间**: 分辨率越高，处理时间越长
- **内存使用**: 高分辨率需要更多内存
- **质量平衡**: 建议根据实际需求选择合适的参数组合

## 兼容性

- 仅适用于RMBG 2.0模型
- 其他抠图模型将使用默认参数
- 向后兼容，不影响现有功能

## 故障排除

1. **处理速度慢**
   - 降低处理分辨率
   - 检查GPU加速是否启用

2. **细节丢失**
   - 提高敏感度设置
   - 增加处理分辨率

3. **边缘噪点**
   - 降低敏感度设置
   - 检查输入图片质量

## 更新日志

- 添加抠图敏感度控制
- 添加处理分辨率选择
- 优化插值算法
- 改进细微发丝处理效果